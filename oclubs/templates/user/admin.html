{% extends "user/personal.html" %}{% from 'macros.html' import get_messages %}
{% block personal %}

<h2 class="title_next">Download</h2>
<div class="col-sm-3 admin_function">
	<h2 class="text-center">Download All Clubs' Info</h2>
	<center>
		<a class="btn btn-success smalltext" href="{{ url_for('clubblueprint.allclubsinfo') }}" target="_blank">Download</a>
	</center>
</div>
<div class="col-sm-3 admin_function">
	<h2 class="text-center">Download All Activities' Info</h2>
	<center>
		<a class="btn btn-success smalltext" data-toggle="modal" data-target="#act_download">Download</a>
	</center>
</div>
<div class="col-sm-3 admin_function">
	<h2 class="text-center">Download All Users' Info</h2>
	<center>
		<a class="btn btn-success smalltext" href="{{ url_for('.allusersinfo') }}" target="_blank">Download</a>
	</center>
</div>

<div class="clearfix"></div>
<br>
<div class="clearfix clearfix-bordered"></div>

<h2 class="title_next">Other Administrative Functions</h2>
<div class="admin_button">
	<a href="{{ url_for('.newteachers') }}" class="btn btn-success">Add New Teachers</a>
</div>
<div class="admin_button">
	<a href="{{ url_for('clubblueprint.adjustclubs') }}" class="btn btn-success">Adjust Excellent Clubs</a>
</div>
<div class="admin_button">
	<a href="{{ url_for('clubblueprint.clubmanagementlist') }}" class="btn btn-success">Access to Clubs' Management</a>
</div>
<div class="admin_button">
	<a href="{{ url_for('.changepassword') }}" class="btn btn-success">Change Accounts' Password</a>
</div>
<div class="admin_button">
	<a href="{{ url_for('.changeuserinfo') }}" class="btn btn-success">Change Users' Info</a>
</div>
<div class="admin_button">
	<a href="{{ url_for('.disableaccounts') }}" class="btn btn-success">Disable Accounts</a>
</div>
<div class="admin_button">
	<a href="#hongmei_schedule" data-toggle="modal" data-target="#hongmei_schedule" class="btn btn-success">Check HongMei Schedule</a>
</div>
<div class="admin_button">
	<a href="{{ url_for('clubblueprint.adjust_status') }}" class="btn btn-success">Adjust Clubs' Status</a>
</div>

<div class="clearfix"></div>
<br>
<div class="clearfix clearfix-bordered"></div>

<h2 class="title_next">Please be careful with following operation</h2>
{{ get_messages(['refresh_users', 'rebuild_search', 'club_creation', 'enable_cleanup']) }}
<div class="admin_button">
	<button class="btn btn-warning" data-toggle="modal" data-target="#confirm_refresh">Refresh Student Accounts</button>
</div>
<div class="admin_button">
	<button class="btn btn-warning" data-toggle="modal" data-target="#fix_search">Auto-fix Search Engine</button>
</div>
<div class="admin_button">
	<a class="btn btn-warning" href="{{ url_for('.download_new_passwords') }}">Download New Accounts' Passwords</a>
</div>
<div class="admin_button">
	<button class="btn btn-warning" data-toggle="modal" data-target="#enable_cleanup">Enable Auto-Cleanup of Inactive Clubs</button>
</div>
<div class="admin_button">
	<button class="btn btn-warning" data-toggle="modal" data-target="#allow_new_club">Allow New Club Creation</button>
</div>

<div id="confirm_refresh" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Confirmation</h4>
			</div>
			<div class="modal-body">
				<p>This operation will update students' accounts with SHSID's authoritative database, so you can use this when new students join. This will disable students' accounts if they disappear from school's database, so please use it with caution.</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-success float-left" data-dismiss="modal">Cancel</button>
				<form action="{{ url_for('.refreshusers_submit') }}" method="post">
					<input name="_csrf_token" type="hidden" value="{{ csrf_token() }}">
					<input type="submit" class="btn btn-danger" value="Refresh">
				</form>
			</div>
		</div>
	</div>
</div>

<div id="fix_search" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Confirmation</h4>
			</div>
			<div class="modal-body">
				<p>When search engine is desynchronized with the database, you can use this operation to auto-fix the problem.</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-success float-left" data-dismiss="modal">Cancel</button>
				<form action="{{ url_for('.rebuildsearch_submit') }}" method="post">
					<input name="_csrf_token" type="hidden" value="{{ csrf_token() }}">
					<input type="submit" class="btn btn-danger" value="Fix">
				</form>
			</div>
		</div>
	</div>
</div>

<div id="hongmei_schedule" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Check HongMei Schedule</h4>
			</div>
			<div class="modal-body">
				<div class="col-sm-4">
					<select name="year" class="form-control" form="download_schedule">
						{% for year in years %}
						<option value="{{ year }}">{{ year }}</option>
						{% endfor %}
					</select>
				</div>
				<div class="col-sm-4">
					<select name="month" class="form-control" form="download_schedule">
						{% for month in range(1,13) %}
						<option value="{{ month }}">{{ month }}</option>
						{% endfor %}
					</select>
				</div>
				<div class="col-sm-4">
					<select name="day" class="form-control" form="download_schedule">
						{% for day in range(1,32) %}
						<option value="{{ day }}">{{ day }}</option>
						{% endfor %}
					</select>
				</div>
				<div class="clearfix"></div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-default float-left" data-dismiss="modal">Close</button>
				<form action="{{ url_for('actblueprint.checkhongmeischedule_download') }}" target="_blank" id="download_schedule" method="post">
					<input name="_csrf_token" type="hidden" value="{{ csrf_token() }}">
					<input type="submit" class="btn btn-success" value="Download">
				</form>
			</div>
		</div>
	</div>
</div>

<div id="enable_cleanup" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Enable Auto-Cleanup of Inactive Clubs</h4>
			</div>
			<div class="modal-body">
				<p>Current Cleanup Status: {% if enable_cleanup %}Enabled{% else %}Disabled{% endif %}
				<p>If cleanup status is enabled, then inactive clubs with no activities will be removed from the database. If cleanup status is disabled, then there will be no auto-cleanup.</p>
				<p>We recommend turning on auto-cleanup after the beginning of the semester.</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-success float-left" data-dismiss="modal">Cancel</button>
				<form action="{{ url_for('clubblueprint.enable_cleanup') }}" method="post">
					<input name="_csrf_token" type="hidden" value="{{ csrf_token() }}">
					<input type="submit" class="btn btn-danger" value="Change Status">
				</form>
			</div>
		</div>
	</div>
</div>

<div id="allow_new_club" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Club Creation</h4>
			</div>
			<div class="modal-body">
				<p>Current Club Creation Status: {% if allow_club_creation %}Allowed{% else %}Not Allowed{% endif %}
				<p>If club creation is allowed, any student can create an inactive club, which can be set to active by admin. If club creation is not allowed, no student can create new club.</p>
			</div>
			<div class="modal-footer">
				<button class="btn btn-success float-left" data-dismiss="modal">Cancel</button>
				<form action="{{ url_for('clubblueprint.allow_new_club_creation') }}" method="post">
					<input name="_csrf_token" type="hidden" value="{{ csrf_token() }}">
					<input type="submit" class="btn btn-danger" value="Change Status">
				</form>
			</div>
		</div>
	</div>
</div>


<div class="modal fade" id="act_download" role="dialog">
	<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Select whether to download all activities or only this week's.</h4>
				</div>
			<div class="modal-body">
				<div class="col-sm-6">
					<a class="btn btn-primary large_button" href="{{ url_for('actblueprint.allactivitiesinfo') }}">Download All Activities</a>
				</div>
				<div class="col-sm-6">
					<a class="btn btn-success large_button" href="{{ url_for('actblueprint.thisweek_activitiesinfo') }}">Download This Week's Activities</a>
				</div>
				<div class="clearfix"></div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

{% endblock %}
