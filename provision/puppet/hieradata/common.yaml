---
classes:
  - '::oclubs'

oclubs::secrets:
  encrypt_key: ''
  flask_key: ''
  mariadb_pw: "%{hiera('mysql::server::root_password')}"
  redis_pw: "%{hiera('redis::requirepass')}"
  db2_conn: ''
  sendgrid_key: ''

redis::bind: '127.0.0.1'

mysql::bindings::daemon_dev: true

elasticsearch::java_install: true
elasticsearch::java_package: 'java-1.8.0-openjdk'
elasticsearch::manage_repo: true
elasticsearch::repo_version: '2.x'

selinux::mode: 'permissive'
selinux::type: 'targeted'

python::dev: present
python::virtualenv: present

# Collision
uwsgi::install_pip: false
uwsgi::install_python_dev: false
uwsgi::package_provider: 'yum'
uwsgi::manage_service_file: false
uwsgi::service_provider: 'systemd'

uwsgi::socket: '/var/run/uwsgi/uwsgi-emperor.sock'
uwsgi::emperor_options:
  stats: '/var/run/uwsgi/stats.sock'
  uid: 'uwsgi'
  gid: 'pythond'
  cap: 'setgid,setuid'
uwsgi::app:
  oclubs:
    ensure: 'present'
    uid: 'uwsgi'
    gid: 'pythond'
    application_options:
      chdir: '/srv/oclubs'
      force-cwd: '/srv/oclubs'
      virtualenv: '/srv/oclubs/venv'
      module: 'oclubs.app:app'
      socket: '/var/run/uwsgi/uwsgi.sock'
      chmod-socket: 666
      master: 'True'
      vaccum: 'True'
      die-on-term: 'True'
      processes: 4
      threads: 2
      plugins: 'python'

nginx::client_max_body_size: 100m
nginx::nginx_upstreams:
  uwsgi:
    ensure: present
    members:
      - 'unix:/var/run/uwsgi/uwsgi.sock'
nginx::nginx_vhosts:
  'oclubs.shs.cn':
    listen_options: default_server
    uwsgi: uwsgi
    add_header:
      Content-Security-Policy: "default-src \\'self\\'"
      X-Content-Type-Options: nosniff
      X-Frame-Options: SAMEORIGIN
nginx::nginx_locations:
  '/static':
    vhost: oclubs.shs.cn
    location_alias: /srv/oclubs/oclubs/static
  '= /favicon.ico':
    vhost: oclubs.shs.cn
    location_alias: /srv/oclubs/oclubs/static/favicon.ico
  '= /robots.txt':
    vhost: oclubs.shs.cn
    location_alias: /srv/oclubs/oclubs/static/robots.txt
  '/images':
    vhost: oclubs.shs.cn
    location_alias: /srv/oclubs/images
